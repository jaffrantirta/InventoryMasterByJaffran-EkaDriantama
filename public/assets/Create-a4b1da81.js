import{_ as D,r as d,j as s,a as t,n as O}from"./app-c2e52a93.js";import{I as A}from"./InputError-dda5b5b1.js";import{I as i}from"./InputLabel-b6c5a941.js";import{P as E}from"./PrimaryButton-d03adcf2.js";import{T as f}from"./TextInput-aa3fc491.js";import{A as G,N as P}from"./AuthenticatedLayout-7e7bb6fa.js";import R from"./TableTransactionDetail-d527cb2b.js";import{n as q}from"./TableHeader-c6fdd518.js";import{t as x}from"./transition-a4acc27a.js";import"./ApplicationLogo-b0e4221b.js";import"./Dropdown-e42d57b0.js";function Y({roles:g,auth:N,items:u,reference_code:F}){const{data:n,setData:r,post:v,processing:b,errors:l,reset:k,recentlySuccessful:w}=D({date:new Date().toISOString().slice(0,10),reference_code:`TR${m()}`,items_selected:[],discount:0}),[T,_]=d.useState(0),[S,C]=d.useState(""),[y,I]=d.useState(u),j=e=>{const a=e.target.value;C(a);const o=u.filter(c=>{var p,h;return((p=c.reference_code)==null?void 0:p.toLowerCase().includes(a.toLowerCase()))||((h=c.name)==null?void 0:h.toLowerCase().includes(a.toLowerCase()))});I(o)};d.useEffect(()=>{},[n.items_selected]);const L=()=>{v(route("transaction.store")),k(),r("reference_code",`TR${m()}`)};function m(){const e=Date.now().toString(),a=Math.floor(Math.random()*1e3).toString().padStart(1,"0");return e+a}const B=(e,a)=>{const o=[...n.items_selected];let c=a*e.price;o.push({...e,qty:a,item_id:e.id,price:e.price,subTotal:c,unit_name:"pcs",is_wholesaler:!1,item:e}),r("items_selected",o)};return s(G,{roles:g,user:N.user,header:t("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Buat Transaksi Penjualan"}),children:[t(O,{title:"Buat Transaksi"}),t("div",{className:"p-5",children:t(x,{show:w,enterFrom:"opacity-0",leaveTo:"opacity-0",className:"transition ease-in-out bg-slate-200 p-3 rounded-3xl",children:t("p",{className:"text-slate-900 dark:text-slate-600 text-center font-bold text-xl",children:"Sukses!"})})}),l&&Object.keys(l).length>0&&t("div",{className:"p-5",children:s(x,{show:Object.keys(l).length>0,enterFrom:"opacity-0",leaveTo:"opacity-0",className:"transition ease-in-out bg-red-200 p-3 rounded-3xl",children:[t("p",{className:"text-red-900 dark:text-red-600 text-center font-bold text-xl",children:"Gagal!"}),Object.keys(l).map((e,a)=>t("p",{className:"text-red-900 dark:text-red-600 text-center font-bold text-xl",children:l[e]},a))]})}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 p-10 gap-10",children:[s("div",{className:"w-full",children:[t(i,{value:"Tanggal"}),t(f,{className:"w-full",name:"date",onChange:e=>r("date",e.target.value),value:n.date,type:"date"}),t(A,{message:l.date})]}),s("div",{className:"w-full",children:[t(i,{value:"Barang"}),t(f,{placeholder:"Cari barang...",className:"w-full",onChange:j,value:S}),t("div",{className:"px-10 p- rounded-3xl mt-5 bg-slate-100 dark:bg-slate-700",children:t("ul",{className:"dark:text-white overflow-scroll font-bold h-32",children:y.map(e=>s("li",{className:"cursor-pointer hover:text-slate-300",onClick:()=>{B(e,1)},children:[e.reference_code," - ",e.name]},e.id))})})]}),s("div",{className:"w-full",children:[t(i,{value:"Kode"}),t("p",{className:"text-3xl font-bold dark:text-white",children:n.reference_code})]}),s("div",{className:"w-full",children:[t(i,{value:"Total"}),s("p",{className:"text-3xl font-bold dark:text-white",children:["Rp.",q(T).format("0,0")]})]})]}),t("div",{className:"p-10 dark:text-slate-200",children:t(R,{is_purchase:!1,heads:["No.","Barang","Jumlah","Satuan","Harga","Total","Aksi"],contents:n.items_selected,listenGrandTotal:e=>_(e),onItemsSelectedUpdate:e=>{r("items_selected",e),r("discount",e)},onDiscountChanged:e=>{r("discount",e)}})}),s("div",{className:"p-10 flex gap-5",children:[t(P,{href:route("transaction.index"),children:"Kembali"}),t(E,{disabled:b,onClick:()=>L(),children:"Simpan"})]})]})}export{Y as default};
