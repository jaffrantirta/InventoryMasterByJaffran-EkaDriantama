import{_ as D,r as m,j as s,a as t,n as O}from"./app-c2e52a93.js";import{I as P}from"./InputError-dda5b5b1.js";import{I as u}from"./InputLabel-b6c5a941.js";import{P as A}from"./PrimaryButton-d03adcf2.js";import{T as f}from"./TextInput-aa3fc491.js";import{A as E,N as G}from"./AuthenticatedLayout-7e7bb6fa.js";import R from"./TableTransactionDetail-d527cb2b.js";import{n as F}from"./TableHeader-c6fdd518.js";import{t as x}from"./transition-a4acc27a.js";import"./ApplicationLogo-b0e4221b.js";import"./Dropdown-e42d57b0.js";function Z({roles:g,auth:N,items:p,reference_code:K}){const{data:o,setData:i,post:b,processing:v,errors:n,reset:_,recentlySuccessful:k}=D({date:new Date().toISOString().slice(0,10),reference_code:`TR${h()}`,items_selected:[]}),[w,T]=m.useState(0),[S,y]=m.useState(""),[C,I]=m.useState(p),j=e=>{const a=e.target.value;y(a);const r=p.filter(l=>{var c,d;return((c=l.reference_code)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))||((d=l.name)==null?void 0:d.toLowerCase().includes(a.toLowerCase()))});I(r)};m.useEffect(()=>{},[o.items_selected]);const L=()=>{b(route("transaction.store.purchase")),_(),i("reference_code",`TR${h()}`)};function h(){const e=Date.now().toString(),a=Math.floor(Math.random()*1e3).toString().padStart(1,"0");return e+a}const B=(e,a)=>{const r=[...o.items_selected],l=r.findIndex(q=>q.item_id===e.id);let c=l!==-1?r[l].qty+a:a,d=c*e.price;l!==-1?(r[l].qty=c,r[l].subTotal=d):r.push({...e,qty:a,item_id:e.id,price:e.price,subTotal:d,unit_name:"pcs",is_wholesaler:!1,item:e}),i("items_selected",r)};return s(E,{roles:g,user:N.user,header:t("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Buat Transaksi Pembelian"}),children:[t(O,{title:"Buat Transaksi"}),t("div",{className:"p-5",children:t(x,{show:k,enterFrom:"opacity-0",leaveTo:"opacity-0",className:"transition ease-in-out bg-slate-200 p-3 rounded-3xl",children:t("p",{className:"text-slate-900 dark:text-slate-600 text-center font-bold text-xl",children:"Sukses!"})})}),n&&Object.keys(n).length>0&&t("div",{className:"p-5",children:s(x,{show:Object.keys(n).length>0,enterFrom:"opacity-0",leaveTo:"opacity-0",className:"transition ease-in-out bg-red-200 p-3 rounded-3xl",children:[t("p",{className:"text-red-900 dark:text-red-600 text-center font-bold text-xl",children:"Gagal!"}),Object.keys(n).map((e,a)=>t("p",{className:"text-red-900 dark:text-red-600 text-center font-bold text-xl",children:n[e]},a))]})}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 p-10 gap-10",children:[s("div",{className:"w-full",children:[t(u,{value:"Tanggal"}),t(f,{className:"w-full",name:"date",onChange:e=>i("date",e.target.value),value:o.date,type:"date"}),t(P,{message:n.date})]}),s("div",{className:"w-full",children:[t(u,{value:"Barang"}),t(f,{placeholder:"Cari barang...",className:"w-full",onChange:j,value:S}),t("div",{className:"px-10 p- rounded-3xl mt-5 bg-slate-100 dark:bg-slate-700",children:t("ul",{className:"dark:text-white overflow-scroll font-bold h-32",children:C.map(e=>s("li",{className:"cursor-pointer hover:text-slate-300",onClick:()=>{B(e,1)},children:[e.reference_code," - ",e.name]},e.id))})})]}),s("div",{className:"w-full",children:[t(u,{value:"Kode"}),t("p",{className:"text-3xl font-bold dark:text-white",children:o.reference_code})]}),s("div",{className:"w-full",children:[t(u,{value:"Total"}),s("p",{className:"text-3xl font-bold dark:text-white",children:["Rp.",F(w).format("0,0")]})]})]}),t("div",{className:"p-10 dark:text-slate-200",children:t(R,{is_purchase:!0,heads:["No.","Barang","Jumlah","Satuan","Harga","Total","Aksi"],contents:o.items_selected,listenGrandTotal:e=>T(e),onItemsSelectedUpdate:e=>{i("items_selected",e)}})}),s("div",{className:"p-10 flex gap-5",children:[t(G,{href:route("transaction.index"),children:"Kembali"}),t(A,{disabled:v,onClick:()=>L(),children:"Simpan"})]})]})}export{Z as default};
